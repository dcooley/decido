<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>decido • decido</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">decido</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/decido.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>decido</h1>
                        <h4 class="author">Michael D. Sumner</h4>
            
            <h4 class="date">2018-02-26</h4>
          </div>

    
    
<div class="contents">
<p>WIP</p>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>This is a basic example of triangulating a single-ring polygon. The output is a vector of triplet indices defining each triangle.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(decido)
x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.69</span>)
y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="dv">0</span>)
(ind &lt;-<span class="st"> </span><span class="kw"><a href="../reference/earcut.html">earcut</a></span>(x, y))
<span class="co">#&gt;  [1] 2 1 7 7 6 5 5 4 3 2 7 5 5 3 2</span>


<span class="kw">plot_ears</span>(<span class="kw">cbind</span>(x, y), ind)</code></pre></div>
<p><img src="decido_files/figure-html/example-1.png" width="672"></p>
<p>Support for holes is provided by two required arguments <code>numholes</code> and <code>holes</code>. The holes are the starting index of each hole, here in R 1-based convention.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">example</span>(earcut, <span class="dt">echo =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; earcut&gt; ## single ring polygon</span>
<span class="co">#&gt; earcut&gt; x &lt;- c(0, 0, 0.75, 1, 0.5, 0.8, 0.69)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; earcut&gt; y &lt;- c(0, 1, 1, 0.8, 0.7, 0.6, 0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; earcut&gt; (ind &lt;- earcut(x, y))</span>
<span class="co">#&gt;  [1] 2 1 7 7 6 5 5 4 3 2 7 5 5 3 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; earcut&gt; plot_ears(cbind(x, y), ind)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<pre><code>#&gt; 
#&gt; earcut&gt; ## polygon with a hole
#&gt; earcut&gt; x &lt;- c(0, 0, 0.75, 1, 0.5, 0.8, 0.69,
#&gt; earcut+      0.2, 0.5, 0.5, 0.3, 0.2)
#&gt; 
#&gt; earcut&gt; y &lt;- c(0, 1, 1, 0.8, 0.7, 0.6, 0,
#&gt; earcut+      0.2, 0.2, 0.4, 0.6, 0.4)
#&gt; 
#&gt; earcut&gt; ind &lt;- earcut(x, y, holes = 8)
#&gt; 
#&gt; earcut&gt; plot_ears(cbind(x, y), ind)</code></pre>
<p><img src="decido_files/figure-html/unnamed-chunk-1-2.png" width="672"></p>
<pre><code>#&gt; 
#&gt; earcut&gt; ## 1) Notice how the hole begins at index 8,
#&gt; earcut&gt; ## hence holes = 8 above, and holes = c(8, 13) below
#&gt; earcut&gt; plot_ears(cbind(x, y), ind, col = "grey", border = NA)</code></pre>
<p><img src="decido_files/figure-html/unnamed-chunk-1-3.png" width="672"></p>
<pre><code>#&gt; 
#&gt; earcut&gt; text(x, y, labels = seq_along(x), pos = 2)
#&gt; 
#&gt; earcut&gt; ## add another hole
#&gt; earcut&gt; x &lt;- c(0, 0, 0.75, 1, 0.5, 0.8, 0.69,
#&gt; earcut+      0.2, 0.5, 0.5, 0.3, 0.2,
#&gt; earcut+       0.15, 0.23, 0.2)
#&gt; 
#&gt; earcut&gt; y &lt;- c(0, 1, 1, 0.8, 0.7, 0.6, 0,
#&gt; earcut+      0.2, 0.2, 0.4, 0.6, 0.4,
#&gt; earcut+       0.65, 0.65, 0.81)
#&gt; 
#&gt; earcut&gt; ind &lt;- earcut(x, y, holes = c(8, 13))
#&gt; 
#&gt; earcut&gt; plot_ears(cbind(x, y), ind, col = "grey")</code></pre>
<p><img src="decido_files/figure-html/unnamed-chunk-1-4.png" width="672"></p>
<pre><code>#&gt; 
#&gt; earcut&gt; # simpler shape with more than one hole
#&gt; earcut&gt; # the two inside holes are open to each other
#&gt; earcut&gt; # (so we can use the same data for one hole or two)
#&gt; earcut&gt; x &lt;- c(0, 0, 1, 1,
#&gt; earcut+        0.4, 0.2, 0.2, 0.4,
#&gt; earcut+        0.6, 0.8, 0.8, 0.6
#&gt; earcut+ )
#&gt; 
#&gt; earcut&gt; y &lt;- c(0, 1, 1, 0,
#&gt; earcut+        0.2, 0.2, 0.4, 0.4,
#&gt; earcut+        0.6, 0.6, 0.4, 0.4
#&gt; earcut+ )
#&gt; 
#&gt; earcut&gt; ind &lt;- decido::earcut(x, y, holes = c(5, 9))
#&gt; 
#&gt; earcut&gt; plot_ears(cbind(x, y), ind, col = "grey")</code></pre>
<p><img src="decido_files/figure-html/unnamed-chunk-1-5.png" width="672"></p>
<pre><code>#&gt; 
#&gt; earcut&gt; plot_holes(cbind(x, y), holes = c(5, 9), col = "grey")</code></pre>
<p><img src="decido_files/figure-html/unnamed-chunk-1-6.png" width="672"></p>
<pre><code>#&gt; 
#&gt; earcut&gt; ind &lt;- decido::earcut(x, y, holes = 5)
#&gt; 
#&gt; earcut&gt; plot_ears(cbind(x, y), ind, col = "grey")</code></pre>
<p><img src="decido_files/figure-html/unnamed-chunk-1-7.png" width="672"></p>
<pre><code>#&gt; 
#&gt; earcut&gt; plot_holes(cbind(x, y), holes = 5, col = "grey")</code></pre>
<p><img src="decido_files/figure-html/unnamed-chunk-1-8.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(oz)
oz_ring &lt;-<span class="st"> </span>oz<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/oz/topics/oz">ozRegion</a></span>(<span class="dt">states =</span> <span class="ot">FALSE</span>)
ring &lt;-<span class="st"> </span>oz_ring<span class="op">$</span>lines[[<span class="dv">6</span>]]
indices &lt;-<span class="st"> </span><span class="kw"><a href="../reference/earcut.html">earcut</a></span>(ring<span class="op">$</span>x, ring<span class="op">$</span>y)
<span class="kw">plot_ears</span>(<span class="kw">cbind</span>(ring<span class="op">$</span>x, ring<span class="op">$</span>y), indices)</code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div id="variants" class="section level2">
<h2 class="hasAnchor">
<a href="#variants" class="anchor"></a>Variants</h2>
<p>The actual triangulation obtained depends on where the polygons start. This is complicated, because of the sheer number of possible variants, combinations of starting points among the island and its holes.</p>
<p>Important “edge” cases are degeneracies, holes touching the island or each other, duplicated edges, intersecting edges, zero-length edges, holes actually external to islands, already existing triangles, and existing quadrilaterals (amongst others). We aren’t going to explore those here, and we are reasonably confident that Mapbox has been presented with a rich enough pool of variant polygons to make its library pretty robust. There’s no uniquely “correct” here either, different systems and standards will apply different rules and allow or choose differently.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vecrot &lt;-<span class="st"> </span><span class="cf">function</span>(x, k) {
  <span class="cf">if</span> (k <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>k <span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(x)) <span class="kw">warning</span>(<span class="st">"k out of bounds of 'x' index"</span>)
  k &lt;-<span class="st"> </span>k <span class="op">%%</span><span class="st"> </span><span class="kw">length</span>(x)
  ## from DescTools::VecRot
  <span class="kw">rep</span>(x, <span class="dt">times =</span> <span class="dv">2</span>)[(<span class="kw">length</span>(x) <span class="op">-</span><span class="st"> </span>k <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">length</span>(x) <span class="op">-</span><span class="st"> </span>k)]
}</code></pre></div>
</div>
<div id="performance" class="section level2">
<h2 class="hasAnchor">
<a href="#performance" class="anchor"></a>Performance</h2>
<p>Compare timing of C++ versus JS implementations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> rbenchmark<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rbenchmark/topics/benchmark">benchmark</a></span>(rearcut<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rearcut/topics/earcut">earcut</a></span>(<span class="kw">cbind</span>(ring<span class="op">$</span>x, ring<span class="op">$</span>y)), decido<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/decido/topics/earcut">earcut</a></span>(ring<span class="op">$</span>x, ring<span class="op">$</span>y))
                                test replications elapsed relative
<span class="co">#2 decido::earcut(ring$x, ring$y)          100   0.064    1.000</span>
<span class="co">#1 rearcut::earcut(cbind(ring$x, ring$y))  100   4.147   64.797</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#example">Example</a></li>
      <li><a href="#variants">Variants</a></li>
      <li><a href="#performance">Performance</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michael Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
