<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>decido - polygon triangulation by ear clipping • decido</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="decido - polygon triangulation by ear clipping">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">decido</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/decido.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>decido - polygon triangulation by ear clipping</h1>
                        <h4 class="author">Michael D. Sumner</h4>
            
            <h4 class="date">2020-04-23</h4>
      
      
      <div class="hidden name"><code>decido.Rmd</code></div>

    </div>

    
    
<div id="constrained-triangulation-of-polygons" class="section level2">
<h2 class="hasAnchor">
<a href="#constrained-triangulation-of-polygons" class="anchor"></a>Constrained triangulation of polygons</h2>
<p>Decido aims to provide very fast constratined triangulations for polygons in R using a robust C++ library created by Mapbox.</p>
<p>Constrained triangulation of polygons by ear clipping is an important low-cost method for decomposing a polygon into triangles. Polygon triangulation is necessary for 3D visualization and many analytical techniques. Here <em>constrained</em> means <strong>shape-preserving</strong>, in the sense that every edge of the polygon will be include as the edge of a triangle in the result.</p>
<p>Ear clipping (or cutting) must be applied to a <em>path-based</em> polygon that consists of only one island, with zero or more holes. Any multiple island polygons must be triangulation separately by this method.</p>
<p>The better-known <em>Delaunay triangulation</em> is generally not shape-preserving as it works only on points, without knowledge of input line segments or polygon edges. Shape-preserving Delaunay or more commonly <em>near-Delaunay</em> triangulation is performed on a set of edges rather than paths, and can be performed on multiple polygons at once. Holes require careful trimming of triangles after the decomposition is performed in this approach.</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>This is a basic example of triangulating a single-ring polygon. The output is a vector of triplet indices defining each triangle.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(decido)</span>
<span id="cb1-2"><a href="#cb1-2"></a>x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.69</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="dv">0</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a>(ind &lt;-<span class="st"> </span><span class="kw"><a href="../reference/earcut.html">earcut</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y)))</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt;  [1] 2 1 7 7 6 5 5 4 3 2 7 5 5 3 2</span></span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw"><a href="../reference/plot_ears.html">plot_ears</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), ind)</span></code></pre></div>
<p><img src="decido_files/figure-html/example-1.png" width="700"></p>
<p>Support for holes is provided by the argument <code>holes</code>. The values are the starting index of each hole, here in R’s 1-based convention.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">## polygon with a hole</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.69</span>,</span>
<span id="cb2-3"><a href="#cb2-3"></a>     <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="dv">0</span>,</span>
<span id="cb2-5"><a href="#cb2-5"></a>     <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a>ind &lt;-<span class="st"> </span><span class="kw"><a href="../reference/earcut.html">earcut</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), <span class="dt">holes =</span> <span class="dv">8</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="kw"><a href="../reference/plot_ears.html">plot_ears</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), ind)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p>The hole-specification is a little subtle, since usually R’s functions (polygon and polypath, and others) expect NA values to separate paths.</p>
<p>Notice how the hole begins at index 8, hence <code>holes = 8</code> above, and <code>holes = c(8, 13)</code> below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="../reference/plot_ears.html">plot_ears</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), ind, <span class="dt">col =</span> <span class="st">"grey"</span>, <span class="dt">border =</span> <span class="ot">NA</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(x, y, <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(x), <span class="dt">pos =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The method is subtle, and it’s also not the only way to do it, the grid package uses a grouping vector rather than a sparse index like this. The spatial packages sp and sf explicitly use structural hierarchies rather than more abstract specifications. The fortify-approach in ggplot2 is more like the grid one. A sparse representation is closer to what is needed for topological operations and visualization, consider that when we have triangles there are no need for “holes”, we can identify which triangles will be plotted and how (or not), and an index into the vertices available becomes a key efficiency feature. (See <a href="https://github.com/hypertidy/silicate">silicate</a> for a lot more on this topic).</p>
<p>This example adds a third polygon, a second hole in the island.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## add another hole</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.69</span>,</span>
<span id="cb4-3"><a href="#cb4-3"></a>     <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>      <span class="fl">0.15</span>, <span class="fl">0.23</span>, <span class="fl">0.2</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a>y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="dv">0</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>     <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>      <span class="fl">0.65</span>, <span class="fl">0.65</span>, <span class="fl">0.81</span>)</span>
<span id="cb4-8"><a href="#cb4-8"></a>ind &lt;-<span class="st"> </span><span class="kw"><a href="../reference/earcut.html">earcut</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), <span class="dt">holes =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">8</span>, <span class="dv">13</span>))</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="kw"><a href="../reference/plot_ears.html">plot_ears</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), ind, <span class="dt">col =</span> <span class="st">"grey"</span>)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="comparing-paths-and-triangles" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-paths-and-triangles" class="anchor"></a>Comparing paths and triangles</h2>
<p>This example defines a much simpler shape, the minimal shape able to be decomposed to triangles (and not stay a triangle).</p>
<p>A quadrilateral, with two holes that are open to each other allows the use of the same data, and we can tweak whether we wanted one hole or two. This is an important example used for validating early versions of this package.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb5-2"><a href="#cb5-2"></a>       <span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>       <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.6</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>)</span>
<span id="cb5-5"><a href="#cb5-5"></a>y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>       <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>       <span class="fl">0.6</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>)</span>
<span id="cb5-9"><a href="#cb5-9"></a>ind &lt;-<span class="st"> </span>decido<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/decido/man/earcut.html">earcut</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), <span class="dt">holes =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5</span>, <span class="dv">9</span>))</span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="kw"><a href="../reference/plot_ears.html">plot_ears</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), ind, <span class="dt">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"triangle plot, two holes"</span>)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw"><a href="../reference/plot_ears.html">plot_holes</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), <span class="dt">holes =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5</span>, <span class="dv">9</span>), <span class="dt">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"path plot, two holes"</span>)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a></span>
<span id="cb7-2"><a href="#cb7-2"></a>ind &lt;-<span class="st"> </span>decido<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/decido/man/earcut.html">earcut</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), <span class="dt">holes =</span> <span class="dv">5</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw"><a href="../reference/plot_ears.html">plot_ears</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), ind, <span class="dt">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"triangle plot, two holes as one"</span>)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-4-3.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw"><a href="../reference/plot_ears.html">plot_holes</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), <span class="dt">holes =</span> <span class="dv">5</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"path plot, two holes as one"</span>)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-4-4.png" width="700"></p>
</div>
<div id="a-geographic-example" class="section level2">
<h2 class="hasAnchor">
<a href="#a-geographic-example" class="anchor"></a>A geographic example</h2>
<p>For good measure we include a geographic example, a triangulation of the mainland part of Tasmania from the <code>oz</code> package.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(oz)</span>
<span id="cb9-2"><a href="#cb9-2"></a>oz_ring &lt;-<span class="st"> </span>oz<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/oz/man/oz.html">ozRegion</a></span>(<span class="dt">states =</span> <span class="ot">FALSE</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>ring &lt;-<span class="st"> </span>oz_ring<span class="op">$</span>lines[[<span class="dv">6</span>]]</span>
<span id="cb9-4"><a href="#cb9-4"></a>indices &lt;-<span class="st"> </span><span class="kw"><a href="../reference/earcut.html">earcut</a></span>(ring[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw"><a href="../reference/plot_ears.html">plot_ears</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ring<span class="op">$</span>x, ring<span class="op">$</span>y), indices)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="variants" class="section level2">
<h2 class="hasAnchor">
<a href="#variants" class="anchor"></a>Variants</h2>
<p>The actual triangulation obtained depends on where the polygons start. This is complicated, because of the sheer number of possible variants, combinations of starting points among the island and its holes.</p>
<p>Important “edge” cases are degeneracies, holes touching the island or each other, duplicated edges, intersecting edges, zero-length edges, holes actually external to islands, already existing triangles, and existing quadrilaterals (amongst others). We aren’t going to explore those here, and we are reasonably confident that Mapbox has been presented with a rich enough pool of variant polygons to make its library pretty robust. There’s no uniquely “correct” here either, different systems and standards will apply different rules and allow or choose differently.</p>
<p>First a function to “rotate” coordinates to different start/end.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>vecrot &lt;-<span class="st"> </span><span class="cf">function</span>(x, k) {</span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="cf">if</span> (k <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>k <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(x)) <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span>(<span class="st">"k out of bounds of 'x' index"</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a>  k &lt;-<span class="st"> </span>k <span class="op">%%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(x)</span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="co">## from DescTools::VecRot</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(x, <span class="dt">times =</span> <span class="dv">2</span>)[(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(x) <span class="op">-</span><span class="st"> </span>k <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(x) <span class="op">-</span><span class="st"> </span>k)]</span>
<span id="cb10-6"><a href="#cb10-6"></a>}</span></code></pre></div>
<p>Now plot each possible variant of definining the polygon ring by traversing the boundary anti-clockwise from a different starting vertex, shown as a filled point symbol.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.69</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="dv">0</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a>(ind &lt;-<span class="st"> </span><span class="kw"><a href="../reference/earcut.html">earcut</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y)))</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#&gt;  [1] 2 1 7 7 6 5 5 4 3 2 7 5 5 3 2</span></span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="kw"><a href="../reference/plot_ears.html">plot_ears</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y), ind)</span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(x[<span class="dv">1</span>], y[<span class="dv">1</span>], <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">"firebrick"</span>)</span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"original"</span>)</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>op &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="cf">for</span> (rot <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(x), <span class="dv">-1</span>)) {</span>
<span id="cb12-3"><a href="#cb12-3"></a>xx &lt;-<span class="st"> </span><span class="kw">vecrot</span>(x, rot); yy &lt;-<span class="st"> </span><span class="kw">vecrot</span>(y, rot)</span>
<span id="cb12-4"><a href="#cb12-4"></a>ind &lt;-<span class="st"> </span><span class="kw"><a href="../reference/earcut.html">earcut</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(xx, yy))</span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="kw"><a href="../reference/plot_ears.html">plot_ears</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(xx, yy), ind)</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"rot %i"</span>, rot))</span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(xx[<span class="dv">1</span>], yy[<span class="dv">1</span>], <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">"firebrick"</span>)</span>
<span id="cb12-8"><a href="#cb12-8"></a>}</span></code></pre></div>
<p><img src="decido_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(op)</span></code></pre></div>
<p>Compare this to constrained Delaunay triangulation from the <code>RTriangle</code> package (not illustrated here but the result is that the <em>constrained</em> triangulation is different from all variants above, and the <em>conforming</em> triangulation inserts two points not included in the original data - these are called Steiner points).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sfdct)</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sf)</span>
<span id="cb14-3"><a href="#cb14-3"></a>xsf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_polygon</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(x, y)[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(x), <span class="dv">1</span>), ])))</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="kw"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sfdct/man/ct_triangulate.html">ct_triangulate</a></span>(xsf, <span class="dt">Y =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span>], <span class="dt">col =</span> <span class="ot">NA</span>)</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">## now a conforming Delaunay triangulation</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="kw"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sfdct/man/ct_triangulate.html">ct_triangulate</a></span>(xsf, <span class="dt">D =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span>], <span class="dt">col =</span> <span class="ot">NA</span>)</span></code></pre></div>
</div>
<div id="performance" class="section level2">
<h2 class="hasAnchor">
<a href="#performance" class="anchor"></a>Performance</h2>
<p>Compare timing of C++ versus JS implementations.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a> rbenchmark<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/rbenchmark/man/benchmark.html">benchmark</a></span>(rearcut<span class="op">::</span><span class="kw">earcut</span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ring<span class="op">$</span>x, ring<span class="op">$</span>y)), decido<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/decido/man/earcut.html">earcut</a></span>(ring<span class="op">$</span>x, ring<span class="op">$</span>y))</span>
<span id="cb15-2"><a href="#cb15-2"></a>                                test replications elapsed relative</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">#2 decido::earcut(ring$x, ring$y)          100   0.064    1.000</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#1 rearcut::earcut(cbind(ring$x, ring$y))  100   4.147   64.797</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#constrained-triangulation-of-polygons">Constrained triangulation of polygons</a></li>
      <li><a href="#example">Example</a></li>
      <li><a href="#comparing-paths-and-triangles">Comparing paths and triangles</a></li>
      <li><a href="#a-geographic-example">A geographic example</a></li>
      <li><a href="#variants">Variants</a></li>
      <li><a href="#performance">Performance</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
